name: CI
on:
  push:
    branches:
      - master
      - 24-add-ci-for-fragments-front-end #test branch
  pull_request:
    branches:
      - master

jobs:
  build_and_test:
    runs-on: ubuntu-latest
    steps:
      - name: Clone Front-End repo
        uses: actions/checkout@v3
        with:
          fetch-depth: 0

      - name: Install npm dependencies
        run: |
          cd Fragments
          npm install

      - name: Build npm packages
        run: |
          cd Fragments
          npm run build

      - name: Run npm tests
        run: |
          cd Fragments
          npm test -- --coverage

  eslint:
    needs: [build_and_test]
    runs-on: ubuntu-latest
    steps:
      - name: Clone Front-End repo
        uses: actions/checkout@v3
        with:
          fetch-depth: 0

      - name: Install eslint
        run: |
          cd Fragments
          yarn

      - name: Run eslint
        run: |
          cd Fragments
          yarn run eslint src/ --ext .js --ext .jsx --color

################################

#   sonarcloud:
#     runs-on: ubuntu-latest

#     needs: [install-and-test]

#     steps:
#       - uses: actions/checkout@v2

#       - name: Install npm dependencies

#         run: |
#           cd Car
#           npm install
#            npm test -- --coverage
#       - name: SonarCloudScan
#         uses: sonarsource/sonarcloud-github-action@master

#         env:
#           GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}

#           SONAR_TOKEN: ${{ secrets.SONAR_TOKEN }}

#         with:
#           args: >
#             -Dsonar.organization=ita-social-projects
#             -Dsonar.projectKey=ita-social-projects_Car-Front-End
#             -Dsonar.javascript.lcov.reportPaths=Car/coverage/lcov.info
#             -Dsonar.sources=./Car
#             -Dsonar.exclusions=**/coverage/**,**/__tests__/**,**/__mocks__/**,**/ios/**,**/android/**,**/*config.js,**/styles/**,**/constants/**,**/data/**,**/ChatStyles/**,**/*Style.tsx,**/*-test.tsx
#             -Dsonar.verbose=false
#             -Dsonar.coverage.exclusions=**/__tests__/**,**/__mocks__/**,**/coverage/**,**/*config.js,**/styles/**,**/constants/**,**/data/**,**/ChatStyles/**,**/ios/**,**/android/**,**/*Style.tsx,**/*-test.tsx
#             -Dsonar.c.file.suffixes=-
#             -Dsonar.cpp.file.suffixes=-
#             -Dsonar.objc.file.suffixes=-
#             -Dsonar.java.file.suffixes=-
